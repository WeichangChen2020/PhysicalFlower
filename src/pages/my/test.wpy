<style type="less">
page{
  background-color: #f6f6f6;
  height: 100%;
}
.title{
font-size:31rpx;
margin-left: 60rpx;
margin-bottom:-10rpx;
}
.icon3{
width:130rpx;
height:130rpx;
margin:5rpx;
margin-left:25rpx;
}
.border {
display:flex;
flex-direction:row;
background-color:#fff;
border-radius:20rpx;
padding:20rpx;
margin:40rpx;
height:175rpx;
}
.contain{
  padding-left:20rpx;
  line-height:55rpx;
  font-size:36rpx;
  margin-left:35rpx;
}
</style>
<template>
  <tab @bindChange.user="change"/>
  <button wx:if="{{tab.selectedId === item.showId}}" wx:for="{{stuQuiuList}}" wx:item="item" wx:key="*this" class='border'  data-idUser="{{item.idUser}}" data-selectedId="{{tab.selectedId}}" @tap='showDetail'>
    <image src='{{item.avatarUrl}}' class='icon3'></image>
    <view class='contain'>
      <view class='title'>姓名：{{item.name}}</view>
      <view class='title'>学号：{{item.stuNum}}</view>
      <view wx:if="{{item.showId === 1}}" class='title'>得分：{{item.quiz_result}}</view>
    </view>
  </button>
</template>
<script>
  import wepy from 'wepy'
  import Tab from '@/components/tab/index'
  export default class testSearch extends wepy.page {
    config ={
      navigationBarTitleText: '测试详情'
    }
    // 可用于页面模板绑定的数据
    data = {
      idCourse: 0,
      idQuiz: 0,
      tab: {
        list: [{id: 1, title: '已提交'}, {id: 2, title: '未提交'}],
        selectedId: 1,
        class: 'tab-success'
      },
      stuQuiuList: []
    };

    components = {
      tab: Tab
    }
    // 事件处理函数(集中保存在methods对象中)
    methods = {
      change(res) {
        this.tab.selectedId = res
        if (JSON.stringify(this.allSigninList) === '{}') {
          this.getAllList()
        }
        this.$apply()
      },
      showDetail(e) {
        let that = this
        console.log(e)
        var selectedId = e.currentTarget.dataset.selectedid
        var idUser = e.currentTarget.dataset.iduser
        if (selectedId === 1) {
          that.$navigate('./stuQuizDetail?idQuiz=' + that.idQuiz + '&idUser=' + idUser)
        }
      }
    };
    onLoad(e) {
      this.$invoke('tab', 'doInitTabData', this.tab)
      let app = this.$parent
      let that = this
      that.idCourse = e.idCourse
      that.idQuiz = e.idQuiz
      var postData = {
        idQuiz: that.idQuiz,
        idCourse: that.idCourse
      }
      app.request('Quiz.getstulistForIdQuiz', postData, 'Loading...')
      .then((res) => {
        that.stuQuiuList = res.data.data
        for (var i = 0; i < that.stuQuiuList.length; i++) {
          if (that.stuQuiuList[i].quiz_result === 0) {
            that.stuQuiuList[i].showId = 2
          } else {
            that.stuQuiuList[i].showId = 1
          }
        }
        that.$apply()
        console.log(that.stuQuiuList)
      })
    };
    onShow() {
    };
    onPullDownRefresh() {
      // this.onLoad({idSignin: this.idSignin})
      wx.stopPullDownRefresh()
    }
  }
</script>
