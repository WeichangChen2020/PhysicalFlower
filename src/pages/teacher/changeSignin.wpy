<style type="less">
page {
  width: 100%;
  height: 100%;
}

view {
display:block;
text-align:center;

}

.greeting {
  font-size: 14px;
  color: gray;
  margin: 20rpx 0 10rpx 20rpx;
}
.img_hd {
  width: 670rpx;
  display: flex;
  flex-direction: row;
  text-align: center;
}
.agreement {
  color: #66e;
  font-style: italic;
  text-decoration: underline;
}

.border {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: white;
  border-width: 4rpx 0 4rpx 0;
  border-style: solid;
  border-color: #eee;
  font-size: 30rpx;
  line-height: 60rpx;
  color: #b95;
  padding: 20rpx 20rpx 40rpx 20rpx;
}
.btn {
  background: linear-gradient(150deg, #d188fb, #9587f8, #558bf7); 
  background-color: #f7536b;
  border: #eee solid 2rpx;
  border-radius: 100rpx;
  color: white;
  width: 295rpx;
  font-size: 30rpx;
  line-height: 70rpx;
  margin-top:35rpx;
}
.input {
  margin-top: 30rpx;
  border-bottom: #ddd solid 2rpx;
}
.container {
  background: #f9f9f9;
  overflow: hidden;
  min-height: 100vh;
  box-sizing: border-box;
  padding: 15px 0;
}
.container::before {
  position: fixed;
  top: 0;
  left: 0;
  content: ' ';
  width: 100%;
  height: 1rpx;
  background-color: #e2e2e2;
  z-index: 5;
}
.doc-title {
  position: relative;
  padding: 15px 0;
  margin: 10px 15px;
  line-height: 25px;
  font-size: 25px;
  color: #666;
}
.doc-description {
  margin: 14px 0;
  padding: 0 15px;
  font-size: 14px;
  line-height: 20px;
  color: #666;
}


.classify-exer-lists .classify-exer-list .icon-exer {
  position: absolute;
  left: 30rpx;
  top: 50%;
  transform: translate3d(0, -50%, 0px);
  -webkit-transform: translate3d(0, -50%, 0px);
  width: 40rpx;
  height: 40rpx;
  border-radius: 20rpx;
  background: #fc8f02
    url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsSAAALEgHS3X78AAABWUlEQVQ4y6WVsUpjURCGvwnR1cbKgEXYaq1MHkBBCIJW1iu+irXd4mtYWW29SGzFFGqpIIqCEIslpYKfRU4gXO5JbuLfnMvM/T9m5lzmorbVa2fXb0pUB06BN2AP+KCaBC7LM0PtVgRNVS2dVSubqnqm6jVgqSLjMSLMAtUa8AQsVATuAv+ywIj4VH/OUuHUliPidd4Z1sqCal2t50yT8rWM5w/QUxslsAbQA04K8XX1YvQddgrJX+qDejsOVRspdqc2C56O6UbLZngPbAPLQFdtJkA3vbIVEc+ztEwydIAfCdQFPoGdiOjnfNnBj6BpCfRSaHMSbGKFo1kCfxkugkvgTN2YC6i2U5svDDfRXnruplzWWHbLbbWvnqsrY/GVFOurrYInf8vAAXAF7EfEYGymA2A/5Q4rVziPihUufhdI2k6h3gD/gWPg/RuwI2AVtTXnT6qoa7X9BT+zVy5f6mfUAAAAAElFTkSuQmCC')
    no-repeat center/20rpx 22rpx;
  overflow: hidden;
}
.classify-exer-lists .classify-exer-list.left {
  border-right: 1rpx solid #f6f6f6;
}

.classify-exer-lists .classify-exer-list .special-exer-tip {
  position: absolute;
  left: 30rpx;
  top: 50%;
  transform: translate3d(0, -50%, 0px);
  -webkit-transform: translate3d(0, -50%, 0px);
  width: 40rpx;
  height: 40rpx;
  background: #73d263;
  border-radius: 20rpx;
  font-size: 24rpx;
  color: #fff;
  text-align: center;
  line-height: 40rpx;
}
.classify-exer-lists.num .classify-exer-list {
  counter-increment: my;
}
.classify-exer-lists.num .classify-exer-list:after {
  position: absolute;
  left: 30rpx;
  top: 50%;
  transform: translate3d(0, -50%, 0px);
  -webkit-transform: translate3d(0, -50%, 0px);
  width: 40rpx;
  height: 40rpx;
  content: counter(my);
  background: #0ae;
  border-radius: 20rpx;
  font-size: 24rpx;
  color: #fff;
  text-align: center;
  line-height: 40rpx;
}
.classify-exer-lists.num .classify-exer-list .classify-exam-num {
  position: absolute;
  right: 30rpx;
  top: 50%;
  transform: translate3d(0, -50%, 0px);
  -webkit-transform: translate3d(0, -50%, 0px);
  font-size: 24rpx;
  color: #999;
  vertical-align: middle;
}
.classify-exer-lists.num
  .classify-exer-list
  .classify-exam-num
  .icon-label-class {
  display: inline-block;
  width: 12rpx;
  height: 20rpx;
  margin-left: 4rpx;
  background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAASCAYAAABit09LAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsSAAALEgHS3X78AAAA4ElEQVQoz43Rr0qEQRiF8We/9SYMgoIIFoPFC7CsxWSyaJHTDGI2LqggosUHDGtQEEyLYcU/WC0Gr8gyGtZvdn3j8GPeOWdQ79UeU6YBzoAbdXMiTPIBbABX6takG0nyCfSAC3W7Cgv+AtaBY3V3HHbGD9Ql4BnoJ7EKC14AXoDzJJdVWPBcwddJTquw4FngFbht+N90u1NWvwGDJP1amPmy8jdM04IWgXfg5Af9Sa0uA0/AUZJBa+HqCjACDpPctf6Mugo8AvtJHtre3VHXgCGwl2RYa2EGOAB2kowmFfkNyq5O87vOCYoAAAAASUVORK5CYII=')
    no-repeat center/10rpx 18rpx;
}

.container {
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-between;
  padding: 200rpx 0;
  box-sizing: border-box;
}
/**app.wxss**/
.pageContainer {
  height: 100%;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  box-sizing: border-box;
}

</style>
<template>
 <canvas canvas-id="photo_canvas" style="width:{{canvasWidth}}px;height:{{canvasHeight}}px;position: absolute;left:-1000000px;top:-1000000px; "></canvas>

  <view class='greeting'>{{courseName}}修改签到</view>
  <view class='border'>
    <view>签到名称</view>
    <input class='input' placeholder='{{signinName}}' focus='{{focus}}' maxlength="15" @input='inputName'/>
    <view>签到起始时间(无法修改)</view>
    <input class='input' placeholder='{{time}}' maxlength="0" />
  </view>

        <view class='border'>
          <view>签到信息修改</view>
            <view class="section__title">设置签到精度(米)</view>
          <input class='input' placeholder='{{radius}}' maxlength="5" @input='radius' />
            <view style="margin-bottom:10px"></view>
            <view class="section">
              <view class="section__title">设置签到持续时间(分钟)</view>
              <input class='input' placeholder='{{lastMinutes}}' maxlength="5" @input='lastMinutes' />
            <view style="margin-bottom:10px"></view>
            </view>
      </view>
    </form>

  </view>

  <view class='greeting'>发布签到</view>
  <view class='border'>
    <button class="btn" style='width:400rpx;height:80rpx' @tap='tap'>修改并发布签到</button>
  </view>
</template>
<script>
import wepy from 'wepy'
import { formatDateTime } from '@/public/js/formatDateTime.js'

// 通过继承自wepy.page的类创建页面逻辑
export default class signinCreat extends wepy.page {
  config ={
    backgroundTextStyle: 'light',
    navigationBarBackgroundColor: '#fff',
    navigationBarTitleText: '修改签到',
    navigationBarTextStyle: 'black'
  }
  // 可用于页面模板绑定的数据
  data = {
    radius: 0,
    gmtStart: 0,
    signinName: '',
    idSignin: 0,
    lastMinutes: 5,
    gmtEnd: 0,
    time: 0
  }

  // 事件处理函数(集中保存在methods对象中)
  methods = {
    radius(e) {
      this.radius = e.detail.value
    },
    inputName(e) {
      this.signinName = e.detail.value
    },
    lastMinutes(e) {
      this.lastMinutes = e.detail.value
    },
    tap(e) {
      let app = this.$parent
      let that = this
      that.gmtEnd = parseInt(that.gmtStart) + that.lastMinutes * 60
      that.gmtEnd = that.gmtEnd.toString()
      console.log(that.gmtEnd)
      var postData = {
        signinName: that.signinName,
        gmtEnd: that.gmtEnd,
        idSignin: that.idSignin,
        radius: that.radius
      }
      console.log(postData)
      app.request('Signin.manageSignin', postData, 'Loading...')
      .then((res) => {
        app.toast('更新信息成功！')
        if (res.data.errCode === 0) {
          setTimeout(() => {
            wx.navigateBack({})
          }, 1000)
        }
      })
    }
  }

  // 页面的生命周期函数
  onLoad(e) {
    let that = this
    that.radius = e.radius
    that.gmtStart = e.gmtStart
    that.time = formatDateTime(that.gmtStart * 1000).substr(-8)
    that.signinName = e.signinName
    that.idSignin = e.idSignin
    that.$apply()
    console.log(that.data)
  }
}
</script>
